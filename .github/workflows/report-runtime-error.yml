name: Handle Runtime Error Report
permissions:
  contents: read
  pull-requests: write
  
on:
  repository_dispatch:
    types: [runtime-error]

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create Issue from Runtime Error
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GH_TOKEN || secrets.GITHUB_TOKEN }}
          script: |
            const error = context.payload.client_payload;
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Runtime Error: ${error.message}`,
              body: `
            ## Runtime Error Report
            **Message:** ${error.message}
            **Stack:**
            \`\`\`
            ${error.stack}
            \`\`\`
            **Component Stack:**
            \`\`\`
            ${error.componentStack}
            \`\`\`
            **User Agent:** ${error.userAgent}
            `,
              assignees: ['jules']
            })
